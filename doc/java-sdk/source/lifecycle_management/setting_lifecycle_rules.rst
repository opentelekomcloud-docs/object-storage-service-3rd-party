:original_name: obs_21_1102.html

.. _obs_21_1102:

Setting Lifecycle Rules
=======================

Function
--------

This API configures lifecycle rules for a bucket to periodically delete objects in the bucket or transition objects between storage classes.

#. An object will be automatically deleted by the OBS server once it expires.
#. The time set in the transition policy of an object must be earlier than its expiration time, and the time set in the transition policy of a noncurrent object version must be earlier than its expiration time.
#. The configured expiration time and transition policy for a noncurrent object version can only take effect when versioning is enabled or suspended for the bucket where that object version is stored.

.. note::

   -  Objects in the Warm storage class have a minimum storage period of 30 days and those in the Cold storage class have a minimum storage period of 90 days. After an object is transitioned to the Cold storage class, if it stays in this storage class for less than 90 days, you still need to pay for a full 90 days.

Restrictions
------------

-  There is no limit on the number of lifecycle rules in a bucket, but the total size of XML descriptions about all lifecycle rules in a bucket cannot exceed 20 KB.
-  A maximum of 20 lifecycle rules can be configured for a parallel file system.
-  To configure a lifecycle rule for a bucket, you must be the bucket owner or have the required permission (**obs:bucket:PutLifecycleConfiguration** in IAM or **PutLifecycleConfiguration** in a bucket policy).
-  Expired objects will be permanently deleted and cannot be recovered.
-  Multi-AZ redundancy is not available for Cold storage. For this reason, buckets or objects with multi-AZ redundancy cannot be transitioned to the Cold storage class based on a lifecycle rule.

Method
------

obsClient.setBucketLifecycle(final :ref:`SetBucketLifecycleRequest <obs_21_1102__table14455523>` :ref:`request <obs_21_1102__table72121329103020>`)

Request Parameters
------------------

.. _obs_21_1102__table72121329103020:

.. table:: **Table 1** List of request parameters

   +-----------------+---------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Type                                                          | Mandatory (Yes/No) | Description                                                                                                      |
   +=================+===============================================================+====================+==================================================================================================================+
   | deleteRequest   | :ref:`SetBucketLifecycleRequest <obs_21_1102__table14455523>` | Yes                | **Explanation:**                                                                                                 |
   |                 |                                                               |                    |                                                                                                                  |
   |                 |                                                               |                    | Request parameters for setting the lifecycle rule. For details, see :ref:`Table 2 <obs_21_1102__table14455523>`. |
   +-----------------+---------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------+

.. _obs_21_1102__table14455523:

.. table:: **Table 2** SetBucketLifecycleRequest

   +-----------------+------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Type                                                             | Mandatory (Yes/No) | Description                                                                                                                                                                       |
   +=================+==================================================================+====================+===================================================================================================================================================================================+
   | bucketName      | String                                                           | Yes                | **Explanation:**                                                                                                                                                                  |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | Bucket name.                                                                                                                                                                      |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | **Restrictions:**                                                                                                                                                                 |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | -  A bucket name must be unique across all accounts and regions.                                                                                                                  |
   |                 |                                                                  |                    | -  A bucket name:                                                                                                                                                                 |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    |    -  Must be 3 to 63 characters long and start with a digit or letter. Lowercase letters, digits, hyphens (-), and periods (.) are allowed.                                      |
   |                 |                                                                  |                    |    -  Cannot be formatted as an IP address.                                                                                                                                       |
   |                 |                                                                  |                    |    -  Cannot start or end with a hyphen (-) or period (.).                                                                                                                        |
   |                 |                                                                  |                    |    -  Cannot contain two consecutive periods (..), for example, **my..bucket**.                                                                                                   |
   |                 |                                                                  |                    |    -  Cannot contain periods (.) and hyphens (-) adjacent to each other, for example, **my-.bucket** or **my.-bucket**.                                                           |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | -  If you repeatedly create buckets of the same name in the same region, no error will be reported and the bucket attributes comply with those set in the first creation request. |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | **Default value**:                                                                                                                                                                |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | None                                                                                                                                                                              |
   +-----------------+------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | lifecycleConfig | :ref:`LifecycleConfiguration <obs_21_1102__table17524114820301>` | Yes                | **Explanation:**                                                                                                                                                                  |
   |                 |                                                                  |                    |                                                                                                                                                                                   |
   |                 |                                                                  |                    | Lifecycle rules for the bucket. For details, see :ref:`Table 3 <obs_21_1102__table17524114820301>`.                                                                               |
   +-----------------+------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _obs_21_1102__table17524114820301:

.. table:: **Table 3** LifecycleConfiguration

   +-----------------+-----------------------------------------------------+--------------------+---------------------------------------------------------------------------------------------+
   | Parameter       | Type                                                | Mandatory (Yes/No) | Description                                                                                 |
   +=================+=====================================================+====================+=============================================================================================+
   | rules           | List<:ref:`Rule <obs_21_1102__table1579215919527>`> | No                 | **Explanation:**                                                                            |
   |                 |                                                     |                    |                                                                                             |
   |                 |                                                     |                    | List of lifecycle rules. For details, see :ref:`Table 4 <obs_21_1102__table1579215919527>`. |
   +-----------------+-----------------------------------------------------+--------------------+---------------------------------------------------------------------------------------------+

.. _obs_21_1102__table1579215919527:

.. table:: **Table 4** Rule

   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                    | Type                                                                         | Mandatory (Yes/No) | Description                                                                                                                                                                                                                                                                                                                                                                                                           |
   +==============================+==============================================================================+====================+=======================================================================================================================================================================================================================================================================================================================================================================================================================+
   | id                           | String                                                                       | No                 | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Lifecycle rule ID.                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Value range**:                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | The value must contain 1 to 255 characters.                                                                                                                                                                                                                                                                                                                                                                           |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | prefix                       | String                                                                       | Yes                | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Object name prefix. It identifies the objects the rule applies to. You can leave this parameter blank to apply the rule to all objects in the bucket.                                                                                                                                                                                                                                                                 |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Assume that you have the following objects: **logs/day1**, **logs/day2**, **logs/day3**, and **ExampleObject.jpg**. If you set **prefix** to **ExampleObject.jpg**, the rule applies to object **ExampleObject.jpg** only. If you set **prefix** to **logs/**, the rule applies to the three objects with name starting with **logs/**. If you leave **prefix** blank, the rule applies to all objects in the bucket. |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Value range**:                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | The value must contain 1 to 1,024 characters.                                                                                                                                                                                                                                                                                                                                                                         |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | enabled                      | boolean                                                                      | Yes                | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Whether to enable the rule.                                                                                                                                                                                                                                                                                                                                                                                           |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Value range**:                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **true**: The rule is enabled.                                                                                                                                                                                                                                                                                                                                                                                        |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **false**: The rule is disabled.                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | expiration                   | :ref:`Expiration <obs_21_1102__table19326162245718>`                         | No                 | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Expiration time of an object. For details, see :ref:`Table 5 <obs_21_1102__table19326162245718>`.                                                                                                                                                                                                                                                                                                                     |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | noncurrentVersionExpiration  | :ref:`NoncurrentVersionExpiration <obs_21_1102__table1264818451195>`         | No                 | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Expiration time of noncurrent object versions. For details, see :ref:`Table 6 <obs_21_1102__table1264818451195>`.                                                                                                                                                                                                                                                                                                     |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Restrictions:**                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | -  This parameter is only available for noncurrent object versions.                                                                                                                                                                                                                                                                                                                                                   |
   |                              |                                                                              |                    | -  Versioning must be enabled (or suspended after being enabled) for the bucket.                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | transitions                  | List<:ref:`Transition <obs_21_1102__table459074282218>`>                     | No                 | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Policies for storage class transition, including transition time and the storage class after transition. For details, see :ref:`Table 7 <obs_21_1102__table459074282218>`.                                                                                                                                                                                                                                            |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Restrictions:**                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | This parameter is only available for the current object version.                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | noncurrentVersionTransitions | List<:ref:`NoncurrentVersionTransition <obs_21_1102__table159971744122413>`> | No                 | **Explanation:**                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | Policies for storage class transition of noncurrent versions, including transition time and the storage class after transition. For details, see :ref:`Table 9 <obs_21_1102__table159971744122413>`.                                                                                                                                                                                                                  |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Restrictions:**                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | -  This parameter is only available for noncurrent object versions.                                                                                                                                                                                                                                                                                                                                                   |
   |                              |                                                                              |                    | -  Versioning must be enabled (or suspended after being enabled) for the bucket.                                                                                                                                                                                                                                                                                                                                      |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | **Default value**:                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                              |                                                                              |                    |                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                              |                                                                              |                    | None                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +------------------------------+------------------------------------------------------------------------------+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _obs_21_1102__table19326162245718:

.. table:: **Table 5** Expiration

   +---------------------------+-----------------+-----------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                 | Type            | Mandatory (Yes/No)                                                                | Description                                                                                                                                                                                                                                            |
   +===========================+=================+===================================================================================+========================================================================================================================================================================================================================================================+
   | days                      | Integer         | Yes if **date** is absent during object storage class transition                  | **Explanation:**                                                                                                                                                                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 | Yes if **date** or **expiredObjectDeleteMarker** is absent during object deletion | Number of days (since the last update was made to the object) after which the lifecycle rule takes effect (the object will be deleted).                                                                                                                |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | **Restrictions:**                                                                                                                                                                                                                                      |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | This parameter is only available for the current object version.                                                                                                                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | **Value range**:                                                                                                                                                                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | A positive integer, in days.                                                                                                                                                                                                                           |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | **Default value**:                                                                                                                                                                                                                                     |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | None                                                                                                                                                                                                                                                   |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | date                      | Date            | Yes if **days** is absent during object storage class transition.                 | **Explanation:**                                                                                                                                                                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 | Yes if **days** or **expiredObjectDeleteMarker** is absent during object deletion | The value must conform to the ISO8601 standards and indicate UTC 00:00. For example, **2018-01-01T00:00:00.000Z** indicates only objects that were last modified before the specified time are transitioned to the specified storage class or deleted. |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | **Default value**:                                                                                                                                                                                                                                     |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | None                                                                                                                                                                                                                                                   |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | expiredObjectDeleteMarker | Boolean         | Yes if **days** or **date** is absent                                             | **Explanation:**                                                                                                                                                                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | Whether to delete expired delete markers. The value can be **true** or **false**. If tags are configured in a lifecycle rule, this element cannot be configured.                                                                                       |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | **Default value**:                                                                                                                                                                                                                                     |
   |                           |                 |                                                                                   |                                                                                                                                                                                                                                                        |
   |                           |                 |                                                                                   | None                                                                                                                                                                                                                                                   |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _obs_21_1102__table1264818451195:

.. table:: **Table 6** NoncurrentVersionExpiration

   +-----------------+-----------------+--------------------+------------------------------------------------------------------+
   | Parameter       | Type            | Mandatory (Yes/No) | Description                                                      |
   +=================+=================+====================+==================================================================+
   | days            | Integer         | Yes                | **Explanation:**                                                 |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | Number of days an object is noncurrent before it expires.        |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | **Restrictions:**                                                |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | This parameter is only available for noncurrent object versions. |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | **Value range**:                                                 |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | A positive integer, in days.                                     |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | **Default value**:                                               |
   |                 |                 |                    |                                                                  |
   |                 |                 |                    | None                                                             |
   +-----------------+-----------------+--------------------+------------------------------------------------------------------+

.. _obs_21_1102__table459074282218:

.. table:: **Table 7** Transition

   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Type                                                      | Mandatory (Yes/No)                                         | Description                                                                                                                                                                                                                                        |
   +=================+===========================================================+============================================================+====================================================================================================================================================================================================================================================+
   | days            | Integer                                                   | This parameter is mandatory if **date** is not configured. | **Explanation:**                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Number of days after its creation when the object is transitioned.                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Restrictions:**                                                                                                                                                                                                                                  |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | This parameter is only available for the current object version.                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Value range**:                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | A positive integer, in days.                                                                                                                                                                                                                       |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Default value**:                                                                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | None                                                                                                                                                                                                                                               |
   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | date            | Date                                                      | This parameter is mandatory if **days** is not configured. | **Explanation:**                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Date when the object will be transitioned.                                                                                                                                                                                                         |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Default value**:                                                                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | None                                                                                                                                                                                                                                               |
   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | storageClass    | :ref:`StorageClassEnum <obs_21_1102__table1242132315405>` | Yes                                                        | **Explanation:**                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Storage class the object is transitioned to.                                                                                                                                                                                                       |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Restrictions:**                                                                                                                                                                                                                                  |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Restrictions on storage class transitions:                                                                                                                                                                                                         |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | -  Only transitions from the Standard storage class to the Warm storage class are supported. To transition objects from Warm to Standard, you must manually do it.                                                                                 |
   |                 |                                                           |                                                            | -  Only transitions from the Standard or Warm storage class to the Cold storage class are supported. To transition objects from Cold to Standard or Warm, you must first restore these objects and then manually transition their storage classes. |
   |                 |                                                           |                                                            | -  Multi-AZ redundancy is not available for Cold storage. For this reason, buckets or objects with multi-AZ redundancy cannot be transitioned to the Cold storage class based on a lifecycle rule.                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Value range**:                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | See :ref:`Table 8 <obs_21_1102__table1242132315405>`.                                                                                                                                                                                              |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Default value**:                                                                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | None                                                                                                                                                                                                                                               |
   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _obs_21_1102__table1242132315405:

.. table:: **Table 8** StorageClassEnum

   ======== ============= ======================
   Constant Default Value Description
   ======== ============= ======================
   STANDARD STANDARD      Standard storage class
   WARM     WARM          Warm storage class.
   COLD     COLD          Cold storage class.
   ======== ============= ======================

.. _obs_21_1102__table159971744122413:

.. table:: **Table 9** NoncurrentVersionTransition

   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Type                                                      | Mandatory (Yes/No)                                         | Description                                                                                                                                                                                                                                        |
   +=================+===========================================================+============================================================+====================================================================================================================================================================================================================================================+
   | days            | Integer                                                   | This parameter is mandatory if **date** is not configured. | **Explanation:**                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Number of days after its creation when the object is transitioned.                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Restrictions:**                                                                                                                                                                                                                                  |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | This parameter is only available for noncurrent object versions.                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Value range**:                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | A positive integer, in days.                                                                                                                                                                                                                       |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Default value**:                                                                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | None                                                                                                                                                                                                                                               |
   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | storageClass    | :ref:`StorageClassEnum <obs_21_1102__table1242132315405>` | Yes                                                        | **Explanation:**                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Storage class the object is transitioned to.                                                                                                                                                                                                       |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Restrictions:**                                                                                                                                                                                                                                  |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | Restrictions on storage class transitions:                                                                                                                                                                                                         |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | -  Only transitions from the Standard storage class to the Warm storage class are supported. To transition objects from Warm to Standard, you must manually do it.                                                                                 |
   |                 |                                                           |                                                            | -  Only transitions from the Standard or Warm storage class to the Cold storage class are supported. To transition objects from Cold to Standard or Warm, you must first restore these objects and then manually transition their storage classes. |
   |                 |                                                           |                                                            | -  Multi-AZ redundancy is not available for Cold storage. For this reason, buckets or objects with multi-AZ redundancy cannot be transitioned to the Cold storage class based on a lifecycle rule.                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Value range**:                                                                                                                                                                                                                                   |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | See :ref:`Table 8 <obs_21_1102__table1242132315405>`.                                                                                                                                                                                              |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | **Default value**:                                                                                                                                                                                                                                 |
   |                 |                                                           |                                                            |                                                                                                                                                                                                                                                    |
   |                 |                                                           |                                                            | None                                                                                                                                                                                                                                               |
   +-----------------+-----------------------------------------------------------+------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. note::

   **Transitions**, **Expiration**, **NoncurrentVersionTransitions**, **AbortIncompleteMultipartUpload**, and **NoncurrentVersionExpiration** must not be all left blank.

Responses
---------

.. table:: **Table 10** Common response headers

   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                                                                 |
   +=======================+=======================+=============================================================================================================================================================================+
   | statusCode            | int                   | **Explanation:**                                                                                                                                                            |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | HTTP status code.                                                                                                                                                           |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | **Value range**:                                                                                                                                                            |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | A status code is a group of digits that can be **2**\ *xx* (indicating successes) or **4**\ *xx* or **5**\ *xx* (indicating errors). It indicates the status of a response. |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | **Default value**:                                                                                                                                                          |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | None                                                                                                                                                                        |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | responseHeaders       | Map<String, Object>   | **Explanation:**                                                                                                                                                            |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | HTTP response header list, composed of tuples. In a tuple, the **String** key indicates the name of the header, and the **Object** value indicates the value of the header. |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | **Default value**:                                                                                                                                                          |
   |                       |                       |                                                                                                                                                                             |
   |                       |                       | None                                                                                                                                                                        |
   +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Code Example: Setting an Object Transition Policy
-------------------------------------------------

This example configures a transition policy for latest and historical object versions in bucket **examplebucket**.

::

   import com.obs.services.ObsClient;
   import com.obs.services.exception.ObsException;
   import com.obs.services.model.LifecycleConfiguration;
   import com.obs.services.model.StorageClassEnum;
   public class SetBucketLifecycle001 {
       public static void main(String[] args) {
           // Obtain an AK/SK pair using environment variables or import the AK/SK pair in other ways. Using hard coding may result in leakage.
           // Obtain an AK/SK pair on the management console.
           String ak = System.getenv("ACCESS_KEY_ID");
           String sk = System.getenv("SECRET_ACCESS_KEY_ID");
           // (Optional) If you are using a temporary AK/SK pair and a security token to access OBS, you are advised not to use hard coding, which may result in information leakage.
           // Obtain an AK/SK pair and a security token using environment variables or import them in other ways.
           // String securityToken = System.getenv("SECURITY_TOKEN");
           // Enter the endpoint corresponding to the region where the bucket is to be created.
           String endPoint = "https://your-endpoint";
           // Obtain an endpoint using environment variables or import it in other ways.
           //String endPoint = System.getenv("ENDPOINT");

           // Create an ObsClient instance.
           // Use the permanent AK/SK pair to initialize the client.
           ObsClient obsClient = new ObsClient(ak, sk,endPoint);
           // Use the temporary AK/SK pair and security token to initialize the client.
           // ObsClient obsClient = new ObsClient(ak, sk, securityToken, endPoint);

           try {
               //Set an object transition policy.
               LifecycleConfiguration config = new LifecycleConfiguration();
               LifecycleConfiguration.Rule rule = config.new Rule();
               rule.setEnabled(true);
               rule.setId("rule1");
               rule.setPrefix("prefix");
               LifecycleConfiguration.Transition transition = config.new Transition();
               // Specify that objects whose names contain the specified prefix will be transitioned 30 days after creation.
               transition.setDays(30);
               // Specify the storage class that the object will be transitioned to.
               transition.setObjectStorageClass(StorageClassEnum.WARM);
               // Specify when the objects whose names contain the specified prefix will be transitioned.
               // transition.setDate(new SimpleDateFormat("yyyy-MM-dd").parse("2018-10-31"));
               rule.getTransitions().add(transition);
               LifecycleConfiguration.NoncurrentVersionTransition noncurrentVersionTransition =
                       config.new NoncurrentVersionTransition();
               // Specify that objects whose names contain the specified prefix will be transitioned 30 days after being historical versions.
               noncurrentVersionTransition.setDays(30);
               // Specify the storage class of the historical object version after transition.
               noncurrentVersionTransition.setObjectStorageClass(StorageClassEnum.COLD);
               rule.getNoncurrentVersionTransitions().add(noncurrentVersionTransition);
               // Set the expiration time of fragments.
               LifecycleConfiguration.AbortIncompleteMultipartUpload abortIncompleteMultipartUpload = config.new AbortIncompleteMultipartUpload();
               abortIncompleteMultipartUpload.setDaysAfterInitiation(7);
               rule.setAbortIncompleteMultipartUpload(abortIncompleteMultipartUpload);
               config.addRule(rule);
               obsClient.setBucketLifecycle("examplebucket", config);
               System.out.println("setBucketLifecycle successfully");
           } catch (ObsException e) {
               System.out.println("setBucketLifecycle failed");
               // Request failed. Print the HTTP status code.
               System.out.println("HTTP Code:" + e.getResponseCode());
               // Request failed. Print the server-side error code.
               System.out.println("Error Code:" + e.getErrorCode());
               // Request failed. Print the error details.
               System.out.println("Error Message:" + e.getErrorMessage());
               // Request failed. Print the request ID.
               System.out.println("Request ID:" + e.getErrorRequestId());
               System.out.println("Host ID:" + e.getErrorHostId());
               e.printStackTrace();
           } catch (Exception e) {
               System.out.println("setBucketLifecycle failed");
               // Print other error information.
               e.printStackTrace();
           }
       }
   }

Code Example: Setting the Object Expiration Time
------------------------------------------------

This example configures the expiration time of latest and historical object versions in bucket **examplebucket**.

::

   import com.obs.services.ObsClient;
   import com.obs.services.exception.ObsException;
   import com.obs.services.model.LifecycleConfiguration;
   public class SetBucketLifecycle002 {
       public static void main(String[] args) {
           // Obtain an AK/SK pair using environment variables or import the AK/SK pair in other ways. Using hard coding may result in leakage.
           // Obtain an AK/SK pair on the management console.
           String ak = System.getenv("ACCESS_KEY_ID");
           String sk = System.getenv("SECRET_ACCESS_KEY_ID");
           // (Optional) If you are using a temporary AK/SK pair and a security token to access OBS, you are advised not to use hard coding, which may result in information leakage.
           // Obtain an AK/SK pair and a security token using environment variables or import them in other ways.
           // String securityToken = System.getenv("SECURITY_TOKEN");
           // Enter the endpoint corresponding to the region where the bucket is to be created.
           String endPoint = "https://your-endpoint";
           // Obtain an endpoint using environment variables or import it in other ways.
           //String endPoint = System.getenv("ENDPOINT");

           // Create an ObsClient instance.
           // Use the permanent AK/SK pair to initialize the client.
           ObsClient obsClient = new ObsClient(ak, sk,endPoint);
           // Use the temporary AK/SK pair and security token to initialize the client.
           // ObsClient obsClient = new ObsClient(ak, sk, securityToken, endPoint);

           try {
               // Set the object expiration time.
               LifecycleConfiguration config = new LifecycleConfiguration();
               LifecycleConfiguration.Rule rule = config.new Rule();
               rule.setEnabled(true);
               rule.setId("rule1");
               rule.setPrefix("prefix");
               LifecycleConfiguration.Expiration expiration = config.new Expiration();
               // Specify that objects whose names contain the specified prefix will expire 60 days after creation.
               expiration.setDays(60);
               // Specify when the objects whose names contain the specified prefix will expire.
               // expiration.setDate(new SimpleDateFormat("yyyy-MM-dd").parse("2018-12-31"));
               rule.setExpiration(expiration);
               LifecycleConfiguration.NoncurrentVersionExpiration noncurrentVersionExpiration =
                       config.new NoncurrentVersionExpiration();
               // Specify that objects whose names contain the specified prefix will expire after changing into historical versions for 60 days.
               noncurrentVersionExpiration.setDays(60);
               rule.setNoncurrentVersionExpiration(noncurrentVersionExpiration);
               config.addRule(rule);
               obsClient.setBucketLifecycle("examplebucket", config);
               System.out.println("setBucketLifecycle successfully");
           } catch (ObsException e) {
               System.out.println("setBucketLifecycle failed");
               // Request failed. Print the HTTP status code.
               System.out.println("HTTP Code:" + e.getResponseCode());
               // Request failed. Print the server-side error code.
               System.out.println("Error Code:" + e.getErrorCode());
               // Request failed. Print the error details.
               System.out.println("Error Message:" + e.getErrorMessage());
               // Request failed. Print the request ID.
               System.out.println("Request ID:" + e.getErrorRequestId());
               System.out.println("Host ID:" + e.getErrorHostId());
               e.printStackTrace();
           } catch (Exception e) {
               System.out.println("setBucketLifecycle failed");
               // Print other error information.
               e.printStackTrace();
           }
       }
   }
